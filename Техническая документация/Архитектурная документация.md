# Архитектурная документация
## Система оценивания учебных работ "EduGrader"

**Версия документа:** 1.0  
**Дата создания:** 22.01.2026  
**Автор:** Ларетина Дарья Алексеевна, группа 21ИС-24  
**Статус:** Учебный проект (проектирование)
**Руководитель практики:** Бобошко Михаил Николаевич

---

## 1. Введение

### 1.1. Назначение документа
Настоящий документ описывает архитектуру системы "EduGrader", включая структуру компонентов, их взаимодействие, схему базы данных и технологический стек.

### 1.2. Область действия
Документ охватывает архитектурные решения, применяемые в системе, и служит руководством для разработки и сопровождения.

### 1.3. Целевая аудитория
- Разработчики системы
- Руководитель учебной практики
- Тестировщики
- Технические писатели

---

## 2. Архитектурный подход

### 2.1. Архитектурный стиль
- **Тип:** Клиент-серверная архитектура
- **Стиль:** Многослойная архитектура (3-уровневая)
- **Паттерн:** RESTful API для взаимодействия компонентов

### 2.2. Уровни архитектуры
```
┌─────────────────────────────────────────────────────────────┐
│                 Уровень представления                       │
│                (Presentation Layer)                         │
│                  Веб-клиент на React                        │
└───────────────────────────┬─────────────────────────────────┘
                            │ HTTP/HTTPS (REST API)
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                 Уровень бизнес-логики                       │
│                (Business Logic Layer)                       │
│                  FastAPI сервер (Python)                    │
└───────────────────────────┬─────────────────────────────────┘
                            │ SQL через ORM
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                 Уровень данных                              │
│                (Data Access Layer)                          │
│                  PostgreSQL база данных                     │
└─────────────────────────────────────────────────────────────┘
```

### 2.3. Компоненты системы
```
Клиентское приложение (Frontend)
├── Модуль аутентификации
├── Модуль управления курсами
├── Модуль заданий
├── Модуль проверки работ
└── Модуль отчетности

Серверное приложение (Backend)
├── API Gateway
├── Сервис пользователей
├── Сервис курсов и заданий
├── Сервис проверки работ
├── Сервис уведомлений
└── Сервис отчетности

База данных (PostgreSQL)
├── Таблицы пользователей
├── Таблицы курсов
├── Таблицы заданий
├── Таблицы работ
└── Таблицы оценок
```

---

## 3. Технологический стек

### 3.1. Серверная часть (Backend)
| Компонент | Технология | Версия | Назначение |
|-----------|------------|---------|------------|
| Язык программирования | Python | 3.11+ | Основной язык разработки |
| Веб-фреймворк | FastAPI | 0.104+ | Создание REST API |
| ORM | SQLAlchemy | 2.0+ | Работа с базой данных |
| Миграции | Alembic | 1.12+ | Управление миграциями БД |
| Аутентификация | JWT | - | Управление доступом |
| Валидация | Pydantic | 2.5+ | Валидация данных |
| Документация | OpenAPI/Swagger | 3.0+ | Документирование API |

### 3.2. Клиентская часть (Frontend)
| Компонент | Технология | Версия | Назначение |
|-----------|------------|---------|------------|
| Фреймворк | React | 18.2+ | Построение пользовательского интерфейса |
| Язык | TypeScript | 5.0+ | Типизированный JavaScript |
| UI библиотека | Material-UI | 5.14+ | Компоненты интерфейса |
| Управление состоянием | Redux Toolkit | 1.9+ | Глобальное состояние |
| Маршрутизация | React Router | 6.20+ | Навигация между страницами |
| HTTP клиент | Axios | 1.6+ | Отправка запросов к API |
| Формы | React Hook Form | 7.48+ | Управление формами |

### 3.3. База данных
| Компонент | Технология | Версия | Назначение |
|-----------|------------|---------|------------|
| СУБД | PostgreSQL | 15+ | Хранение структурированных данных |
| Графический клиент | pgAdmin | 7+ | Администрирование БД |
| Драйвер | psycopg2 | 2.9+ | Подключение Python к PostgreSQL |

### 3.4. Инфраструктура и инструменты
| Компонент | Технология | Назначение |
|-----------|------------|------------|
| Контейнеризация | Docker + Docker Compose | Развертывание и изоляция |
| Контроль версий | Git + GitHub | Управление исходным кодом |
| CI/CD | GitHub Actions | Автоматизация сборки и тестирования |
| Тестирование API | Postman | Тестирование эндпоинтов |
| Линтинг | ESLint, Prettier, flake8 | Проверка качества кода |

---

## 4. Схема взаимодействия компонентов

### 4.1. Последовательность типичных операций

#### 4.1.1. Загрузка работы студентом
```
1. Студент → Frontend: Нажимает "Загрузить работу"
2. Frontend → Backend: POST /api/submissions (JWT токен, файл)
3. Backend → PostgreSQL: INSERT в таблицу submissions
4. Backend → Frontend: 201 Created (ID работы)
5. Backend → Сервис уведомлений: Событие "работа загружена"
6. Сервис уведомлений → Преподаватель: Email/внутрисистемное уведомление
```

#### 4.1.2. Проверка работы преподавателем
```
1. Преподаватель → Frontend: Выбирает работу для проверки
2. Frontend → Backend: GET /api/submissions/{id} (JWT токен)
3. Backend → PostgreSQL: SELECT работы и данные студента
4. Backend → Frontend: Данные работы и критерии оценки
5. Преподаватель → Frontend: Заполняет форму оценки
6. Frontend → Backend: PUT /api/grades (оценка, комментарии)
7. Backend → PostgreSQL: UPDATE оценок, INSERT комментариев
8. Backend → Сервис уведомлений: Событие "работа проверена"
9. Сервис уведомлений → Студент: Уведомление о результатах
```

### 4.2. API взаимодействие

#### 4.2.1. Основные группы эндпоинтов
```
/auth          - Аутентификация и авторизация
/users         - Управление пользователями
/courses       - Управление курсами и группами
/assignments   - Управление заданиями
/submissions   - Загрузка и управление работами
/grades        - Оценка работ и управление оценками
/reports       - Генерация отчетов
/notifications - Управление уведомлениями
```

#### 4.2.2. Формат запросов/ответов
- **Формат данных:** JSON
- **Кодировка:** UTF-8
- **Методы HTTP:** GET, POST, PUT, DELETE
- **Статус ответов:** Стандартные HTTP статусы
- **Аутентификация:** Bearer Token (JWT)

---

## 5. Структура базы данных

### 5.1. Концептуальная модель
```
Пользователь (User)
    ├── преподает → Курс (Course)
    ├── учится → Курс (Course) через Enrollment
    ├── создает → Задание (Assignment)
    ├── загружает → Работа (Submission)
    └── оценивает → Оценка (Grade)

Курс (Course)
    ├── содержит → Задание (Assignment)
    └── включает → Группа (Group)

Задание (Assignment)
    ├── имеет → Критерий оценки (Criterion)
    └── принимает → Работа (Submission)

Работа (Submission)
    └── получает → Оценка (Grade)

Оценка (Grade)
    ├── состоит из → Оценка по критерию (CriterionGrade)
    └── включает → Комментарий (Comment)
```

### 5.2. Физическая модель данных

#### 5.2.1. Таблица users (Пользователи)
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    role VARCHAR(20) NOT NULL CHECK (role IN ('admin', 'teacher', 'student')),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

#### 5.2.2. Таблица courses (Курсы)
```sql
CREATE TABLE courses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    code VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    teacher_id UUID REFERENCES users(id) ON DELETE CASCADE,
    academic_year INTEGER NOT NULL,
    semester INTEGER NOT NULL CHECK (semester IN (1, 2)),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

#### 5.2.3. Таблица enrollments (Записи на курсы)
```sql
CREATE TABLE enrollments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    student_id UUID REFERENCES users(id) ON DELETE CASCADE,
    course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
    enrollment_date DATE DEFAULT CURRENT_DATE,
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'completed', 'dropped')),
    UNIQUE(student_id, course_id)
);
```

#### 5.2.4. Таблица assignments (Задания)
```sql
CREATE TABLE assignments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    assignment_type VARCHAR(50) CHECK (assignment_type IN ('lab', 'project', 'test', 'essay')),
    max_score DECIMAL(5,2) NOT NULL,
    weight DECIMAL(5,2) DEFAULT 1.0,
    published_at TIMESTAMP WITH TIME ZONE,
    deadline_at TIMESTAMP WITH TIME ZONE NOT NULL,
    allow_resubmission BOOLEAN DEFAULT FALSE,
    max_attempts INTEGER DEFAULT 1,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

#### 5.2.5. Таблица criteria (Критерии оценки)
```sql
CREATE TABLE criteria (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    assignment_id UUID REFERENCES assignments(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    max_score DECIMAL(5,2) NOT NULL,
    weight DECIMAL(5,2) DEFAULT 1.0,
    order_index INTEGER NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

#### 5.2.6. Таблица submissions (Сданные работы)
```sql
CREATE TABLE submissions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    assignment_id UUID REFERENCES assignments(id) ON DELETE CASCADE,
    student_id UUID REFERENCES users(id) ON DELETE CASCADE,
    file_path VARCHAR(500) NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_size INTEGER NOT NULL,
    file_type VARCHAR(100),
    attempt_number INTEGER DEFAULT 1,
    submission_comment TEXT,
    status VARCHAR(20) DEFAULT 'submitted' CHECK (status IN ('submitted', 'graded', 'returned')),
    submitted_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(assignment_id, student_id, attempt_number)
);
```

#### 5.2.7. Таблица grades (Оценки)
```sql
CREATE TABLE grades (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    submission_id UUID REFERENCES submissions(id) ON DELETE CASCADE,
    teacher_id UUID REFERENCES users(id) ON DELETE SET NULL,
    total_score DECIMAL(5,2) NOT NULL,
    feedback TEXT,
    grading_date TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    grading_duration INTERVAL,
    is_final BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

#### 5.2.8. Таблица criterion_grades (Оценки по критериям)
```sql
CREATE TABLE criterion_grades (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    grade_id UUID REFERENCES grades(id) ON DELETE CASCADE,
    criterion_id UUID REFERENCES criteria(id) ON DELETE CASCADE,
    score DECIMAL(5,2) NOT NULL,
    comment TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(grade_id, criterion_id)
);
```

#### 5.2.9. Таблица comments (Комментарии)
```sql
CREATE TABLE comments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    submission_id UUID REFERENCES submissions(id) ON DELETE CASCADE,
    author_id UUID REFERENCES users(id) ON DELETE CASCADE,
    content TEXT NOT NULL,
    is_inline BOOLEAN DEFAULT FALSE,
    inline_position JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

#### 5.2.10. Таблица notifications (Уведомления)
```sql
CREATE TABLE notifications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    type VARCHAR(50) NOT NULL,
    title VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    is_read BOOLEAN DEFAULT FALSE,
    metadata JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    read_at TIMESTAMP WITH TIME ZONE
);
```

### 5.3. Индексы базы данных

```sql
-- Индексы для ускорения поиска
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_courses_teacher ON courses(teacher_id);
CREATE INDEX idx_courses_active ON courses(is_active);
CREATE INDEX idx_enrollments_student ON enrollments(student_id);
CREATE INDEX idx_enrollments_course ON enrollments(course_id);
CREATE INDEX idx_assignments_course ON assignments(course_id);
CREATE INDEX idx_assignments_deadline ON assignments(deadline_at);
CREATE INDEX idx_submissions_assignment ON submissions(assignment_id);
CREATE INDEX idx_submissions_student ON submissions(student_id);
CREATE INDEX idx_submissions_status ON submissions(status);
CREATE INDEX idx_grades_submission ON grades(submission_id);
CREATE INDEX idx_notifications_user ON notifications(user_id);
CREATE INDEX idx_notifications_read ON notifications(is_read);
```

### 5.4. Представления (Views)

```sql
-- Представление для отображения успеваемости студентов
CREATE VIEW student_performance AS
SELECT 
    u.id as student_id,
    u.first_name,
    u.last_name,
    c.id as course_id,
    c.name as course_name,
    a.id as assignment_id,
    a.title as assignment_title,
    s.submitted_at,
    g.total_score,
    a.max_score,
    ROUND((g.total_score / a.max_score) * 100, 2) as percentage
FROM users u
JOIN submissions s ON u.id = s.student_id
JOIN assignments a ON s.assignment_id = a.id
JOIN courses c ON a.course_id = c.id
LEFT JOIN grades g ON s.id = g.submission_id
WHERE u.role = 'student';
```

---

## 6. Модули системы

### 6.1. Модуль аутентификации и авторизации
**Назначение:** Управление доступом пользователей к системе
- Регистрация и вход пользователей
- JWT-аутентификация
- Управление сессиями
- Восстановление пароля

### 6.2. Модуль управления курсами
**Назначение:** Управление учебными курсами и группами
- Создание и редактирование курсов
- Назначение преподавателей
- Формирование учебных групп
- Управление расписанием

### 6.3. Модуль управления заданиями
**Назначение:** Создание и управление учебными заданиями
- Создание заданий с критериями оценки
- Настройка дедлайнов
- Прикрепление учебных материалов
- Управление шаблонами рубрик

### 6.4. Модуль загрузки и проверки работ
**Назначение:** Обработка студенческих работ
- Загрузка файлов работ
- Валидация форматов и размеров
- Интерфейс проверки для преподавателей
- Система комментариев и аннотаций

### 6.5. Модуль оценок и отчетности
**Назначение:** Управление оценками и генерация отчетов
- Расчет итоговых оценок
- Формирование ведомостей
- Генерация статистики
- Экспорт данных

### 6.6. Модуль уведомлений
**Назначение:** Информирование пользователей о событиях
- Email-уведомления
- Внутрисистемные оповещения
- Настройка предпочтений уведомлений
- История уведомлений

---

## 7. Требования к развертыванию

### 7.1. Конфигурация сервера
- **ОС:** Ubuntu 22.04 LTS или Windows Server 2022
- **Процессор:** 2+ ядра
- **Память:** 4+ ГБ RAM
- **Диск:** 50+ ГБ свободного места
- **Сеть:** Статический IP адрес, доменное имя

### 7.2. Порты и сеть
```
80/tcp    - HTTP (редирект на HTTPS)
443/tcp   - HTTPS (основной порт)
5432/tcp  - PostgreSQL (локальный доступ)
8000/tcp  - FastAPI development
3000/tcp  - React development
```

### 7.3. Переменные окружения
```bash
# Базовые настройки
APP_NAME="EduGrader"
APP_ENV="production"
SECRET_KEY="your-secret-key-here"

# База данных
DATABASE_URL="postgresql://user:password@localhost:5432/edugrader"
POSTGRES_DB="edugrader"
POSTGRES_USER="edugrader_user"
POSTGRES_PASSWORD="secure_password"

# JWT настройки
JWT_SECRET_KEY="jwt-secret-key"
JWT_ALGORITHM="HS256"
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Email настройки
SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_USER="noreply@edugrader.com"
SMTP_PASSWORD="email_password"

# Файловое хранилище
UPLOAD_FOLDER="/var/www/edugrader/uploads"
MAX_FILE_SIZE_MB=50
ALLOWED_EXTENSIONS="pdf,doc,docx,zip,rar,txt"
```

---

## 8. Безопасность

### 8.1. Меры безопасности
1. **Аутентификация:** JWT с короткоживущими токенами
2. **Авторизация:** Ролевая модель (RBAC)
3. **Шифрование:** TLS 1.3 для всех соединений
4. **Валидация:** Проверка всех входных данных
5. **Защита от инъекций:** Параметризованные запросы

### 8.2. Ролевая модель
```python
ROLES = {
    'admin': ['read', 'write', 'delete', 'manage_users', 'system_settings'],
    'teacher': ['read', 'write', 'grade', 'manage_courses', 'view_reports'],
    'student': ['read', 'submit', 'view_grades', 'view_courses']
}
```

### 8.3. Резервное копирование
- **Частота:** Ежедневно автоматическое
- **Хранение:** 30 дней
- **Тестирование:** Ежемесячная проверка восстановления
- **Шифрование:** Бекапы шифруются

---

## 9. Мониторинг и логирование

### 9.1. Логирование
- **Формат:** JSON структурированные логи
- **Уровни:** DEBUG, INFO, WARNING, ERROR, CRITICAL
- **Хранение:** 90 дней
- **Анализ:** ELK Stack или аналоги

### 9.2. Метрики
- Время ответа API
- Количество активных пользователей
- Объем хранимых данных
- Количество операций в день
- Ошибки и исключения

---

## 10. Дальнейшее развитие

### 10.1. Планируемые улучшения
1. **Интеграция с LMS:** Подключение к Moodle, Blackboard
2. **AI-анализ:** Автоматическая проверка типовых заданий
3. **Мобильное приложение:** iOS и Android клиенты
4. **Офлайн-режим:** Работа без подключения к интернету
5. **Интеграция с Git:** Проверка программного кода

### 10.2. Масштабирование
- Горизонтальное масштабирование серверов приложения
- Репликация базы данных
- Использование Redis для кеширования
- CDN для статических файлов

---

## Приложение A: Схема базы данных (ER-диаграмма)

```
[users] 1───┐
            │
            ├──0..* [enrollments] 0..*───1 [courses]
            │                                 │
            │                                1..*
            │                                 │
            │                            [assignments]
            │                                1..*
            │                                 │
            │                            [criteria]
            │                                 │
            │                                1..*
            │                                 │
1───0..* [submissions] 0..1───1 [grades] 1───*
            │                     │
            │                    1..*
            │                     │
            │                [criterion_grades]
            │
           1..*
            │
       [comments]
```

---

## Приложение B: SQL скрипт инициализации БД

```sql
-- init_db.sql
-- Создание базы данных и пользователя
CREATE DATABASE edugrader;
CREATE USER edugrader_user WITH PASSWORD 'secure_password';
GRANT ALL PRIVILEGES ON DATABASE edugrader TO edugrader_user;

-- Подключение к базе данных
\c edugrader

-- Включение расширений
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Создание таблиц (как описано в разделе 5.2)
-- [Все CREATE TABLE statements из раздела 5.2]

-- Создание индексов
-- [Все CREATE INDEX statements из раздела 5.3]

-- Создание представлений
-- [CREATE VIEW statement из раздела 5.4]

-- Начальные данные
INSERT INTO users (email, password_hash, first_name, last_name, role) 
VALUES 
('admin@edugrader.edu', 'hashed_password', 'Администратор', 'Системы', 'admin'),
('teacher@edugrader.edu', 'hashed_password', 'Иван', 'Преподавателев', 'teacher'),
('student@edugrader.edu', 'hashed_password', 'Петр', 'Студентов', 'student');
```

---

**Разработал:**  
___________________________  
**Ларетина Дарья Алексеевна**  
Студент группы 21ИС-24  
Дата: 22.01.2026

**Принял:**  
___________________________  
**Бобошко Михаил Николаевич**  
Руководитель учебной практики  
Дата: ___________________

---